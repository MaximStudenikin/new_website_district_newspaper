{* post stream (list) wrapper *}

{* главная страница или нет *}
{if $wa->currentUrl() == $wa_app_url}

<div class="row">
  {if $wa->currentUrl() != '/gallery/'}
  <div class="col-lg-9 col-md-9">
    <div class="maincontent__content">
      <h2 class="h2 bold main-title stellForever">НОВОСТИ</h2>
      <div class="main-slider slider-common">
        {$mainSliderNews = blogViewEasyHelper::getMainSliderNews()}
        {$img_path = blogViewEasyHelper::getSliderImgPath()}
        <ul class="main-bxlider">
          {foreach $mainSliderNews as $item}
          <li>

            {if !empty($item.slider_img)}
            {$img_new_path = "{$img_path}{$item.id}/{$item.slider_img}"}
            {else}
            {$img_new_path = "{$img_path}/default-pic-big.jpg"}
            {/if}

            <div class="content--news" style="background: url({$img_new_path}) no-repeat top center; background-size: cover;">
              <div class="content--news_wrapper"></div>
                <div class="news-gallery-links">
                  <a href="/gallery" class="news-video">видео</a>
                  <a href="/gallery" class="news-photo">фото</a>
                </div>
                <span class="news-date">{$item.datetime|wa_datetime:"humandate"}</span>
                <h3 class="news-title"><a href="/{$item.url}" style="text-decoration: none!important;">{$item.title}</a></h3>
                <p class="news-announcement">{$item.announcement}</p>
            </div>
          </li>
          {/foreach}
        </ul>
      </div>

      <!-- для ленты колумнистики  -->
      {$lenta1 = blogViewEasyHelper::getLentaNews(3)}
      <!-- /для ленты колумнистики  -->

      <!--Для вывода картинок превью-->
      {$img_path = blogViewEasyHelper::getSliderImgPath()}
      <!--/Для вывода картинок превью-->

      <!--Блок новостей-->
        <!-- 1,2 - id рубрик новостей -->
        {$lenta = blogViewEasyHelper::getLentaNews(3)}

	<section class="news-section row">
    <a class="section__heading" href="/category/novosti-goroda/">Новости</a>
		<div class="news row" data-class="slider__teg">
				{$lenta = blogViewEasyHelper::getLentaNews(3)}			
			<ul class="news__list" data-class="slider__list">
					{foreach $lenta as $item}
				<li class="news__item active__slide" data-class="slider__item">
					<div class="section__img">
							{$previewImg = blogViewEasyHelper::getPreviewImg($item.id)} 
							{if !$previewImg.slider_img == ''}
						<img class="img__teg" src="{$img_path}{$item.id}/{$previewImg.slider_img}" alt="alt"> 
						{else}
						<img class="img__teg" src="{$img_path}/95.jpg">
						{/if}
					</div>
					<time class="publication__date section__row" datetime="{$item.datetime|wa_datetime:" humandate "}">
						{$item.datetime|wa_datetime:"humandate"}
					</time>
					<a class="section__title section__row" href="/{$item.url}">{$item.title}</a>
					<p class="section__description section__row">{$item.text|strip_tags|truncate:50}</p>
					{/foreach}
				</li>
			</ul>
			<div class="pagination row show__blok-phones">
				<ul class="pagination__list" data-class="pagination__list">
					<!-- Генерация через JS -->
				</ul>
			</div>
  </section>
  
    {$wa->block("banners__center")}

      <!--Блок аннонсов-->
<section class="news-section row">
		<a class="section__heading" href="/category/anonsy/">Анонсы</a>
		<div class="news row" data-class="slider__teg">
      {$added_slider = blogViewEasyHelper::getNews()}
			<ul class="news__list" data-class="slider__list">
        {foreach $added_slider as $item}
				<li class="news__item active__slide" data-class="slider__item">
					<div class="section__img">
							{$previewImg = blogViewEasyHelper::getPreviewImg($item.id)} 
							{if !$previewImg.slider_img == ''}
						<img class="img__teg" src="{$img_path}{$item.id}/{$previewImg.slider_img}" alt="{$item.title}"> 
						{else}
						<img class="img__teg" src="{$img_path}/95.jpg">
						{/if}
					</div>
					<time class="publication__date section__row" datetime='{$item.datetime|wa_datetime:"humandate"}'>
						{$item.datetime|wa_datetime:"humandate"}
					</time>
					<a class="section__title section__row" href='/{$item.url}'>{$item.title}</a>
          {/foreach}
        </li>
			</ul>
			<div class="pagination row show__blok-phones">
				<ul class="pagination__list" data-class="pagination__list">
					<!-- Генерация через JS -->
				</ul>
			</div>
	</section>

      {$wa->block("mos.tizer")}

      <!-- Блок статей -->
	<section class="news-section row">
		<a class="section__heading" href="/category/stati-iz-gazety/">Статьи</a>
		<div class="news row" data-class="slider__teg">
				{$lastPages = blogViewEasyHelper::getPapperNews(3)}
			<ul class="news__list" data-class="slider__list">
					{foreach $lastPages as $item name=news_iterator} 
				<li class="news__item active__slide" data-class="slider__item">
					<div class="section__img">
							{$previewImg = blogViewEasyHelper::getPreviewImg($item.id)} 
							{if !$previewImg.slider_img == ''}
						<img class="img__teg" src="{$img_path}{$item.id}/{$previewImg.slider_img}" alt="{$item.title}"> 
						{else}
						<img class="img__teg" src="{$img_path}/95.jpg">
						{/if}
					</div>
					<time class="publication__date section__row" datetime='{$item.datetime|wa_datetime:"humandate"}'>
						{$item.datetime|wa_datetime:"humandate"}
					</time>
					<a class="section__title section__row" href='/{$item.url}'>{$item.title}</a>
					{/foreach}
				</li>
			</ul>
			<div class="pagination row show__blok-phones">
				<ul class="pagination__list" data-class="pagination__list">
					<!-- Генерация через JS -->
				</ul>
			</div>
	</section>


      <div class="col-md-12 thumbs">

      <!-- облако тегов -->
        <div class="row">
          <div class="col-lg-12 col-md-12 hidden-sm hidden-xs content--tagsCloud">
              <h2 class="content--tagsCloud_title">Популярные теги</h2>
              <div class="all-tags">
                {$customAllTagView = blogTagPlugin::customAllTagView(50)}
                {$customAllTagView.sidebar}
              </div>
          </div>
        </div>
      <!--/облако тегов -->


        <div class="content--banners">
          {$banners = bannerViewHelper::getAll()}
          <!--<div class="row">-->
          <ul class="banners-bxslider">
            {foreach $banners as $item name=banner_cycle}
            <li>
              <!--<div class="col-lg-4">-->
              <a class="banner-link" target="_blank" href="{$item.url}">
                <img src="{$item.img}">
              </a>
              <!--</div>-->
            </li>
            {/foreach}
          </ul>
          <!--</div>-->
        </div>

      </div>
    </div>
  </div>


  <div class="col-lg-3 col-md-3 print">
    <div class="maincontent__sidebar">
  <div class="row">

  <!--Афиша-->
    <div class="col-lg-12 col-md-12 col-sm-6 hidden-xs sidebar--calendar calendar">
        <h3>
          <a href="/category/afisha/">Афиша</a>
        </h3>
        <div class="calendar-container">
          <table id="calendar2" class="calendar-table">
            <thead>
            <tr>
              <td class="calendar__prev">‹
              <td colspan="5" class='calendar-head'>
              <td class="calendar__next">›
            <tr>
              <td>Пн
              <td>Вт
              <td>Ср
              <td>Чт
              <td>Пт
              <td>Сб
              <td>Вс
            <tbody>
          </table>
        </div>

         <div class="banners">
   <a href="http://gazetauzao.ru/po-vsem-voprosam-svyazannym-s-renovatsiey-mozhno-obratitsya-v-gorodskoy-shtab/" class="block-1" target="_blank"><img class="block-1" src="http://gazetauzao.ru/wa-data/public/photos/13/31/23113/23113.970.jpg"></a>
   </div>

    </div>
    <!--/Афиша-->

    <!--Галерея-->
      {$lastPhotoId = photosViewHelper::lastPhotoId()}
      {$lastPhoto = photosViewHelper::lastPhoto('id/{$lastPhotoId}')}
      <div class="col-lg-12 col-md-12 col-sm-6 sidebar--gallery" style="background: url({$lastPhoto.thumb_970x0.url}) no-repeat top center; background-size: cover;">
        <a href="/gallery/">Галерея</a>
      </div>
    <!--/Галерея-->
    </div>

    <div class="row">
    <!--Колумнистика-->
      <div class="col-lg-12 col-md-12 col-sm-6 sidebar--columnistic">
      {$columnistika = blogViewEasyHelper::getColumnistikaNews()}
      {$img_path = blogViewEasyHelper::getSliderImgPath()}

        <!--<h2 class="h2 bold yel">Колумнистика</h2>-->
        <h3>
          <a href="/category/kolumnistika/">Колумнистика</a>
        </h3>

        <div class="columnistic-bxslider">
          {foreach $columnistika as $item}
          {$previewImg = blogViewEasyHelper::getPreviewImg($item.id)}
          <div class="col-lg-12 col-xs-12 sidebar--columnistic_content">
            <div>
              <img src="{$img_path}{$item.id}/{$previewImg.slider_img}" class="userpic" alt="">
            </div>
            <p><a class="thumbs__link" href="/{$item.url}">{$item.title}</a></p>
          </div>
          {/foreach}
        </div>
      </div>
      <!--/Колумнистика-->

      <!--Баннеры-->
      <div class="col-lg-12 col-md-12 col-sm-6 col-xs-12 sidebar--banners">
        {$wa->block("Bannerinobosti")}
      </div>
      <!--/Баннеры-->
    </div>
    
    <!-- /Новый год -->

    <!--Гость-->
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-6 sidebar--guest">
            <h3>
              <a href="/category/zvanyy-gost/">Званый гость</a>
            </h3>
          {$guest = blogViewEasyHelper::getGuests()}
          {$img_path = blogViewEasyHelper::getSliderImgPath()}
          {foreach $guest as $item}
          <div class="sidebar--guest_content" style="background: url({$img_path}{$item.id}/{$item.slider_img}) no-repeat top center; background-size: cover;">
                <a href="/{$item.url}">
                <p>{$item.title|strip_tags|truncate:20}
                </br>
                {$item.text|strip_tags|truncate:60}</p>
                </a>
          </div>
            {/foreach}
      </div>
      <!--/Гость-->

      <!--Опрос-->
      <div class="col-lg-12 col-md-12 col-sm-6 hidden-xs sidebar--quiz">
        <h3>
          <a href="/arkhiv-golosovaniy/">Опрос</a>
        </h3>
        {$wa->ecalc->getStyles()}
        <div class="swiper-survey" style="width: 251px; height: 190px; margin-left: 13px; overflow: hidden">
          <div class="swiper-wrapper">
            {$wa->ecalc->getEnabledCalcs()}
          </div>

          <div class="swiper-pagination">
          </div>
        </div>
        {$wa->ecalc->getJS()}
        <script type="text/javascript"
                src="{$wa_active_theme_url}swiperStreamInit.js?v{$wa_theme_version}"></script>
      </div>
    <!--/Опрос-->
    </div>
    
    <div class="block-title print">

      <a href="/wa-data/public/blog/archive/{blogViewEasyHelper::getLastFromArchiveLink()}/index.html" class="block-link" target="_self">
        <img class="block-img" src="{$wa_theme_url}banners/vypusk.png" title="Свежий выпуск" alt="Свежий выпуск">
      </a>

    </div>
  </div>
</div>


  {else}
  <div class="col-sm-12">
    <!--Блок фото-->
    <div class="content--gallery">
      <h2 class="content--gallery_title">
        Фото
      </h2>

      <!-- 1,2 - id рубрик новостей -->

      {$photos = $wa->photos->albums(false)}
      <div class="row gallery-bxlider">
        {$iter = 1}
        {foreach $photos as $item}
        {if ({$iter} == 1) || ({$iter} mod 2 == 1)}<div class="content--gallery_collumn">{/if}
            <div class="col-xs-12 content--gallery_item">
              <!-- <h4>{$item.datetime|wa_datetime:"humandate"}</h4> -->
              {$previewImg = $wa->photos->photo($item.key_photo_id,"500")}
              {if $previewImg.url == ''}
              <a href="{$item.url}">
                <img src="/wa-data/public/blog/slider_img//95.jpg">
              </a>
              {else}
              <a href="{$item.url}">
                <img src="{$previewImg.thumb_500.url}">
              </a>
              {/if}
              <p>
                <a href="{$item.url}">{$item.name}</a>
              </p>
            </div>
        {if ({$iter} mod 2 == 0)}</div>{/if}
        {$iter = {$iter + 1}}
        {/foreach}
      </div>
    </div>
    <!--/Блок фото-->


    <!--Блок видео-->
    <div class="content--gallery">
      <h2 class="content--gallery_title">
        Видео
      </h2>

      <!-- 1,2 - id рубрик новостей -->
      {$lenta = blogViewEasyHelper::getVideo()}

      <div class="row gallery-bxlider">
        {$iter = 1}
        {foreach $lenta as $item}
          {if ({$iter} == 1) || ({$iter} mod 2 == 1)}<div class="content--gallery_collumn">{/if}
          <div class="col-xs-12 content--gallery_item">
            <!-- <h4>{$item.datetime|wa_datetime:"humandate"}</h4> -->
            {$previewImg = blogViewEasyHelper::getPreviewImg($item.id)}
            {if !$previewImg.slider_img == ''}
            <a href="/{$item.url}">
              <span class="gallery_item_play"></span>
              <img src="/wa-data/public/blog/slider_img//95.jpg">
            </a>
            {else}
            <a href="/{$item.url}">
              <span class="gallery_item_play"></span>
              <img src="/wa-data/public/blog/slider_img//95.jpg">
            </a>
            {/if}
            <p>
              <a href="/{$item.url}">{$item.title}</a>
            </p>
          </div>
          {if ({$iter} mod 2 == 0)}</div>{/if}
          {$iter = {$iter + 1}}
        {/foreach}
      </div>
    </div>
    <!--/Блок видео-->
  </div>
  {/if}
</div>

{/if}
{$is_lazyloading = false}

{if !$is_lazyloading && $wa->currentUrl() != $wa_app_url}
<div id="post-stream" role="main" class="lazyloading" {if $wa->param('blog_url')}itemscope itemtype="http://schema.org/Blog"{/if}>
  {/if}

  {if !$is_lazyloading and !empty($stream_title)}<h1>{$stream_title|escape}</h1>{/if}

  {if $wa->currentUrl() == '/category/primaries/'}
  <a href="http://pg.er.ru/">
    <img src="/wa-data/public/site/data/img/banners/primeris_banner.jpg" alt="Баннер праймериз">
  </a>
  {/if}

  <a name="page_{$page}"></a>

  {if $is_search}
  {include file="stream_search.html" inline}
  {else}
  {include file="stream_posts.html" inline}
  {/if}

  {if $is_lazyloading or ($page eq 1)}
  <div class="pageless-wrapper {if $wa->currentUrl() == $wa_app_url}hidden{/if}"{if !$is_lazyloading } style="display:none;"{/if}>

    {if $page lt $pages}
    {$loaded_post_count=(count($posts)+$posts_per_page * ($page-1) )}
    {_w('%d post','%d posts',$loaded_post_count)}&nbsp;{_w('of %d post','of %d posts',$post_count)}
    <br>
    <a href="?page={$page+1}" class="pageless-link">[`Show older posts`]</a>
    <div class="pageless-progress" style="display:none;"><i class="icon16 loading"></i>[`Loading...`]</div>
    {elseif isset($page) && $pages}
    {_w('%d post','%d posts',$post_count)}
    {/if}

  </div>
  {/if}


</div>


{if !$is_lazyloading && $wa->currentUrl() != $wa_app_url}
<!--<ul class="menu-h test" id="stream-paging">
{for $p=1 to $pages}
<li{if $p eq $page} class="selected"{/if}><a href="{if $p eq $page}#page_{$page}{else}?page={$p}{/if}">{$p}</a></li>
{/for}
</ul>-->
<div id="stream-paging" data-text="{$smarty.get.query}">
</div>
<script type="text/javascript">
  $(function() {
    $('#stream-paging').pagination({
      items: {$pages},

      hrefTextPrefix: '{if $p eq $page}#page_{else}?{if isset($smarty.get.query)}query={$stream_title|escape}&{/if}page={/if}',
      currentPage: {for $p=1 to $pages}{if $p eq $page}{$p}{/if}{/for}
    });
  });
</script>
{/if}