// логика из коробки

/*Алгоритм мимизации: YUI Compressor Version 2.4.8pre*/

$(function () { $.blog_utils.highlight("#post-stream"); var c = function (g, h, f) { b(); $(".comment-form").find("input[name=parent]").val(h); var e = $(".comment-form").show().insertAfter(g).find("[name=text]").val(""); if (f) { e.focus() } }; var b = function (f) { var e = $(".comment-form"); e.find(".errormsg").remove(); e.find(".error").removeClass("error"); e.find(".wa-captcha-refresh").click(); if (f) { e.find("textarea").val("") } }; $(".comment-reply").live("click", function () { var e = $(this).parents(".comment"); var f = e.length ? parseInt($(e).attr("id").replace(/^[\D]+/, "")) : 0; c($(this).parent(), f, true); $(".comment").removeClass("in-reply-to"); e.addClass("in-reply-to"); return false }); $(".comment-form input:submit").click(function () { var f = $(this); f.attr("disabled", true).next().show(); var e = $(".comment-form"); var g = $(".comment-form form"); $.post(g.attr("action") + "?json=1", g.serialize(), function (h) { f.attr("disabled", false).next().hide(); if (h.status && h.status == "ok" && h.data.redirect) { window.location.replace(h.data.redirect); window.location.href = h.data.redirect; return } if (h.status && h.status == "ok" && h.data) { var j = $(h.data.template); var i = h.data.count_str; var k; if (e.prev().is(".comments")) { k = e.prev(".comments").children("ul") } else { k = e.parent(); if (!k.next("ul").size()) { k.after("<ul></ul>") } k = k.next("ul") } k.append($("<li />").append(j)); c(".comments", 0); if (h.data.comment_id) { $("#comment-" + h.data.comment_id).addClass("new") } $(".not-comment").remove(); $(".comment").removeClass("in-reply-to"); $(".comment-count").show().html(i); j.trigger("plugin.comment_add"); b(true) } else { if (h.status && h.status == "fail") { b(); var l = h.errors; $(l).each(function (o) { var m = this; for (name in m) { var n = $(".comment-form form").find("[name=" + name + "]"); n.after($('<em class="errormsg"></em>').text(m[name])).addClass("error") } }) } else { b(false) } } }, "json").error(function () { b(false) }); return false }); var d = "guest"; var a = $("ul#user-auth-provider li.selected"); if (a.length) { d = a.attr("data-provider") || d } else { a = $("#user-auth-provider"); if (a.length) { d = a.attr("data-provider") || d } } if (d) { $(".tab").hide(); if (d == "signup") { $(".comment-submit, .comment-body").hide() } else { $(".comment-submit, .comment-body").show() } $("div.tab[data-provider='" + d + "']").show(); $("input[name=auth_provider]").val(d); if (d == "guest") { $(".wa-captcha").show() } else { $(".wa-captcha").hide() } } $("ul#user-auth-provider li.selected a, ul#user-auth-provider li:eq(0) a").click(function () { if ($(this).parent().hasClass("selected")) { return false } var e = $(this).parent().attr("data-provider"); $(this).parent().addClass("selected").siblings().removeClass("selected"); $(".tab").hide(); $("div.tab[data-provider='" + e + "']").show(); if (e == "guest") { $(".wa-captcha").show() } else { $(".wa-captcha").hide() } if (e == "signup") { $(".comment-submit, .comment-body").hide() } else { $(".comment-submit, .comment-body").show() } $("input[name=auth_provider]").val(e); return false }) }); $.blog_utils = { query: "", init: function () { if (location.href.indexOf("?") !== -1) { var c = location.href.indexOf("?"); var b = location.href.slice(c + 1).split("&"); for (var a = 0; a < b.length; a += 1) { if (b[a].indexOf("query=") !== -1) { this.query = b[a].slice(b[a].indexOf("query=") + 6); break } } } }, highlight: function (a) { if (this.query) { $(a).find(".search-match").find("h3 a, p").each(function () { var b = $(this).html(); b = b.replace(new RegExp("(" + $.blog_utils.query + ")", "i"), '<span class="highlighted">$1</span>'); $(this).html(b) }) } } }; $.blog_utils.init();